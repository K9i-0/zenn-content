---
title: "go_router_builder 3.0.0ã®ç ´å£Šçš„å¤‰æ›´ã«ã¤ã„ã¦"
emoji: "ğŸ™"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Flutter", "Dart", "go_router", "go_router_builder"]
published: false
---

# go_router_builder 3.0.0ã®ç ´å£Šçš„å¤‰æ›´ã«ã¤ã„ã¦

go_router_builderãŒ3.0.0ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚Œã¦ã€ç ´å£Šçš„å¤‰æ›´ãŒå…¥ã‚Šã¾ã—ãŸã€‚
æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§go_router_builderã‚’ä½¿ã£ã¦ã‚‹äººã¯å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚

ä»Šå›ã®è¨˜äº‹ã§ã¯ã€å¤‰æ›´å†…å®¹ã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ–¹æ³•ã ã‘ã§ãªãã€**ãªãœã“ã®å¤‰æ›´ãŒå¿…è¦ã ã£ãŸã®ã‹**ã¨**ä½•ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã‹**ã‚’è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚

## ä»Šå›ã®å¤‰æ›´ã®èƒŒæ™¯

### æ ¹æœ¬çš„ãªå•é¡Œ

go_router_builder 2.x.xã§ã¯ã€ãƒ«ãƒ¼ãƒˆã‚¯ãƒ©ã‚¹ã«å¯¾ã—ã¦extensionã§`go(context)`ã‚„`push(context)`ã€`location`ãªã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã—ãŸã€‚

ã—ã‹ã—ã€ã“ã®æ–¹æ³•ã«ã¯é‡è¦ãªåˆ¶é™ãŒã‚ã‚Šã¾ã—ãŸï¼š

```dart
// 2.x.xã®å ´åˆ
GoRouteData route; // æŠ½è±¡çš„ãªå‹

route.go(context); // âŒ Error: 'go'ã¯å®šç¾©ã•ã‚Œã¦ã„ãªã„
route.location;    // âŒ Error: 'location'ã¯å®šç¾©ã•ã‚Œã¦ã„ãªã„
```

ãªãœãªã‚‰ã€extensionã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯å…·ä½“çš„ãªã‚¯ãƒ©ã‚¹ï¼ˆ`HomeRoute`ã€`LoginRoute`ãªã©ï¼‰ã§ã—ã‹åˆ©ç”¨ã§ããšã€åŸºåº•ã‚¯ãƒ©ã‚¹ï¼ˆ`GoRouteData`ï¼‰ã§ã¯ä½¿ãˆãªã„ã‹ã‚‰ã§ã™ã€‚

ã“ã‚ŒãŒ[Issue #106790](https://github.com/flutter/flutter/issues/106790)ã§å ±å‘Šã•ã‚ŒãŸå•é¡Œã§ã—ãŸã€‚

### å®Ÿéš›ã®å•é¡Œä¾‹

```dart
// 2.x.xã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ãŒæ›¸ã‘ã¾ã›ã‚“ã§ã—ãŸ
extension on GoRouteData {
  void customGo(BuildContext context) {
    go(context); // âŒ extensionã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯è¦‹ãˆãªã„
  }
}

// å‹•çš„ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚‚å›°é›£
void navigateToRoute(GoRouteData route, BuildContext context) {
  route.go(context); // âŒ extensionã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯è¦‹ãˆãªã„
}
```

## ä½•ãŒå¤‰ã‚ã£ãŸã‹

### Route classes now required to use a mixin `with _$RouteName`

ä¸€ç•ªå¤§ããªå¤‰æ›´ã¯ã€**ãƒ«ãƒ¼ãƒˆã‚¯ãƒ©ã‚¹ã§mixinã®ä½¿ç”¨ãŒå¿…é ˆ**ã«ãªã£ãŸã“ã¨ã§ã™ã€‚

#### å¤‰æ›´å‰ï¼ˆ2.x.xï¼‰

```dart:routes.dart
@TypedGoRoute<HomeRoute>(path: '/')
class HomeRoute extends GoRouteData {
  const HomeRoute();

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return const HomeScreen();
  }
}
```

ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ï¼š
```dart:routes.g.dart
extension $HomeRouteExtension on HomeRoute {
  String get location => '/';
  void go(BuildContext context) => context.go(location);
  void push(BuildContext context) => context.push(location);
}
```

#### å¤‰æ›´å¾Œï¼ˆ3.0.0ï¼‰

```dart:routes.dart
@TypedGoRoute<HomeRoute>(path: '/')
class HomeRoute extends GoRouteData with _$HomeRoute {
  const HomeRoute();

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return const HomeScreen();
  }
}
```

ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ï¼š
```dart:routes.g.dart
mixin _$HomeRoute on GoRouteData {
  String get location => '/';
  void go(BuildContext context) => context.go(location);
  void push(BuildContext context) => context.push(location);
}
```

## ã“ã®å¤‰æ›´ã§ä½•ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‹

### 1. æŠ½è±¡çš„ãªå‹ã§ã®æ“ä½œãŒå¯èƒ½

```dart
// 3.0.0ã§ã¯å¯èƒ½ï¼
GoRouteData route = const HomeRoute();

route.go(context);    // âœ… OK
route.location;       // âœ… OK
route.push(context);  // âœ… OK
```

### 2. å…±é€šã®extensionã‚’ä½œæˆå¯èƒ½

```dart
extension GoRouteDataExtension on GoRouteData {
  void safeGo(BuildContext context) {
    // ä½•ã‚‰ã‹ã®å‰å‡¦ç†
    if (mounted) {
      go(context); // âœ… mixinã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒä½¿ãˆã‚‹
    }
  }
  
  void goWithAnalytics(BuildContext context, {Map<String, dynamic>? parameters}) {
    // ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒ­ã‚°
    Analytics.track('route_navigation', {
      'route': location,
      ...?parameters,
    });
    go(context);
  }
}
```

### 3. å‹•çš„ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯

```dart
class RoutingService {
  static void navigateTo(GoRouteData route, BuildContext context) {
    // âœ… ä»»æ„ã®ãƒ«ãƒ¼ãƒˆã‚’å—ã‘å–ã£ã¦é·ç§»å¯èƒ½
    route.go(context);
  }
  
  static void conditionalNavigation(BuildContext context) {
    final route = userIsLoggedIn ? const HomeRoute() : const LoginRoute();
    route.go(context); // âœ… å‹•çš„ã«ãƒ«ãƒ¼ãƒˆã‚’æ±ºã‚ã¦é·ç§»
  }
}
```

### 4. ã‚ˆã‚Šè‰¯ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

```dart
abstract class BaseRoute extends GoRouteData {
  // å…±é€šã®æŒ¯ã‚‹èˆã„ã‚’å®šç¾©
  void navigateWithPermissionCheck(BuildContext context) {
    if (hasPermission()) {
      go(context); // âœ… mixinã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒä½¿ãˆã‚‹
    } else {
      const PermissionDeniedRoute().go(context);
    }
  }
}

class HomeRoute extends BaseRoute with _$HomeRoute {
  // å…·ä½“çš„ãªå®Ÿè£…
}
```

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ‰‹é †

### 1. pubspec.yamlã®æ›´æ–°

ã¾ãšã€go_router_builderã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’3.0.0ã«æ›´æ–°ã—ã¾ã™ã€‚

```yaml:pubspec.yaml
dev_dependencies:
  go_router_builder: ^3.0.0
  build_runner: ^2.0.0
```

### 2. ãƒ«ãƒ¼ãƒˆã‚¯ãƒ©ã‚¹ã®ä¿®æ­£

å…¨ã¦ã®ãƒ«ãƒ¼ãƒˆã‚¯ãƒ©ã‚¹ã«é©åˆ‡ãªmixinã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

```dart:routes.dart
// HomeRoute
@TypedGoRoute<HomeRoute>(path: '/')
class HomeRoute extends GoRouteData with _$HomeRoute {
  // ... æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰
}

// å­ãƒ«ãƒ¼ãƒˆã®ä¾‹
@TypedGoRoute<ProductDetailRoute>(path: '/product/:id')
class ProductDetailRoute extends GoRouteData with _$ProductDetailRoute {
  final String id;
  
  const ProductDetailRoute({required this.id});

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return ProductDetailScreen(productId: id);
  }
}

// ShellRouteã®ä¾‹
class MainShellRoute extends ShellRouteData with _$MainShellRoute {
  const MainShellRoute();

  @override
  Widget builder(BuildContext context, GoRouterState state, Widget navigator) {
    return MainShell(child: navigator);
  }
}
```

### 3. ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã®å®Ÿè¡Œ

ä¿®æ­£å¾Œã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
dart run build_runner build --delete-conflicting-outputs
```

## å®Ÿéš›ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¾‹

### ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ«ãƒ¼ãƒˆ

```dart:routes.dart
// å¤‰æ›´å‰
@TypedGoRoute<LoginRoute>(path: '/login')
class LoginRoute extends GoRouteData {
  final String? redirectPath;
  
  const LoginRoute({this.redirectPath});

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return LoginScreen(redirectPath: redirectPath);
  }
}

// å¤‰æ›´å¾Œ
@TypedGoRoute<LoginRoute>(path: '/login')
class LoginRoute extends GoRouteData with _$LoginRoute {
  final String? redirectPath;
  
  const LoginRoute({this.redirectPath});

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return LoginScreen(redirectPath: redirectPath);
  }
}
```

### è¤‡é›‘ãªãƒ«ãƒ¼ãƒˆï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆä»˜ãï¼‰

```dart:routes.dart
// å¤‰æ›´å‰
@TypedGoRoute<ProfileRoute>(path: '/profile')
class ProfileRoute extends GoRouteData {
  const ProfileRoute();

  @override
  String? redirect(BuildContext context, GoRouterState state) {
    final authState = AuthProvider.of(context);
    if (!authState.isLoggedIn) {
      return const LoginRoute().location;
    }
    return null;
  }

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return const ProfileScreen();
  }
}

// å¤‰æ›´å¾Œ
@TypedGoRoute<ProfileRoute>(path: '/profile')
class ProfileRoute extends GoRouteData with _$ProfileRoute {
  const ProfileRoute();

  @override
  String? redirect(BuildContext context, GoRouterState state) {
    final authState = AuthProvider.of(context);
    if (!authState.isLoggedIn) {
      return const LoginRoute().location;
    }
    return null;
  }

  @override
  Widget build(BuildContext context, GoRouterState state) {
    return const ProfileScreen();
  }
}
```

## åŠ¹ç‡çš„ã«ã‚„ã‚‹æ–¹æ³•

### ä¸€æ‹¬ç½®æ›ã‚’ä½¿ã†

å¤§è¦æ¨¡ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã‚‰ã€ã‚¨ãƒ‡ã‚£ã‚¿ã®ä¸€æ‹¬ç½®æ›ãŒä¾¿åˆ©ã§ã™ã€‚

**æ¤œç´¢ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š**
```
class (\w+Route) extends GoRouteData \{
```

**ç½®æ›ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š**
```
class $1 extends GoRouteData with _$$1 {
```

### VSCodeã®å ´åˆ

1. `Cmd/Ctrl + Shift + H`ã§ç½®æ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã
2. æ­£è¦è¡¨ç¾ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹ï¼ˆ`.*`ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
3. ä¸Šè¨˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ä¸€æ‹¬ç½®æ›

## ã‚ˆãã‚ã‚‹ãƒˆãƒ©ãƒ–ãƒ«

### ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼

```bash:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
[SEVERE] go_router_builder on lib/routes.dart:
Missing mixin _$HomeRoute on HomeRoute
```

è©²å½“ã®ãƒ«ãƒ¼ãƒˆã‚¯ãƒ©ã‚¹ã«`with _$RouteName`ã‚’è¿½åŠ ã—å¿˜ã‚Œã¦ã¾ã™ã€‚

### æ—¢å­˜ã®ç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ã®ç«¶åˆ

```bash:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
[WARNING] Conflicting outputs were detected
```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ä¸€åº¦ã‚¯ãƒªãƒ¼ãƒ³ã—ã¦ã‹ã‚‰å†ç”Ÿæˆã—ã¾ã—ã‚‡ã†ã€‚
```bash:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
dart run build_runner clean
dart run build_runner build
```

### å‹ã‚¨ãƒ©ãƒ¼

```bash:ã‚¿ãƒ¼ãƒŸãƒŠãƒ«
The mixin '_$HomeRoute' can't be mixed in because it's missing...
```

- `part`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ãŒæ­£ã—ãè¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- ã‚³ãƒ¼ãƒ‰ç”ŸæˆãŒæ­£å¸¸ã«å®Œäº†ã—ã¦ã„ã‚‹ã‹ç¢ºèª

## ä»Šå¾Œã®å±•æœ›

ä»Šå›ã®mixinåŒ–ã«ã‚ˆã‚Šã€å°†æ¥çš„ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š

- `GoRouteData`ã®åŸºåº•ã‚¯ãƒ©ã‚¹ã«ç›´æ¥ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
- ã‚ˆã‚Šé«˜åº¦ãªå‹å®‰å…¨ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°API
- ã‚«ã‚¹ã‚¿ãƒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œã®çµ±ä¸€çš„ãªå®Ÿè£…

è©³ç´°ã¯[PR #9275](https://github.com/flutter/packages/pull/9275)ã¨[é–¢é€£ã™ã‚‹PR](https://github.com/flutter/packages/pull/9277)ã§ç¢ºèªã§ãã¾ã™ã€‚

## ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] pubspec.yamlã§go_router_builderã‚’3.0.0ã«æ›´æ–°
- [ ] å…¨ã¦ã®GoRouteDataç¶™æ‰¿ã‚¯ãƒ©ã‚¹ã«é©åˆ‡ãªmixinã‚’è¿½åŠ 
- [ ] å…¨ã¦ã®ShellRouteDataç¶™æ‰¿ã‚¯ãƒ©ã‚¹ã«é©åˆ‡ãªmixinã‚’è¿½åŠ 
- [ ] ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’å®Ÿè¡Œï¼ˆ`dart run build_runner build`ï¼‰
- [ ] ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
- [ ] ãƒ†ã‚¹ãƒˆãŒæ­£å¸¸ã«é€šã‚‹ã“ã¨ã‚’ç¢ºèª

## ã¾ã¨ã‚

go_router_builder 3.0.0ã§ã¯ã€ãƒ«ãƒ¼ãƒˆã‚¯ãƒ©ã‚¹ã§ã®mixinä½¿ç”¨ãŒå¿…é ˆã«ãªã‚Šã¾ã—ãŸã€‚
ã“ã‚Œã¯å˜ãªã‚‹å¤‰æ›´ã§ã¯ãªãã€**å‹å®‰å…¨ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ã‚ˆã‚ŠæŸ”è»Ÿã§å¼·åŠ›**ã«ã™ã‚‹ãŸã‚ã®é‡è¦ãªã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ã™ã€‚

å¤‰æ›´è‡ªä½“ã¯å˜ç´”ã§ã™ãŒã€æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯å…¨ã¦ã®ãƒ«ãƒ¼ãƒˆã‚¯ãƒ©ã‚¹ã®ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚

ãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šï¼š
- **èƒŒæ™¯**: extensionã®åˆ¶é™ã«ã‚ˆã‚ŠæŠ½è±¡çš„ãªå‹ã§ã®æ“ä½œãŒã§ããªã‹ã£ãŸ
- **å¤‰æ›´**: extensionã‹ã‚‰mixinã¸ã®ç§»è¡Œã§æŸ”è»Ÿæ€§ãŒå‘ä¸Š
- **ãƒ¡ãƒªãƒƒãƒˆ**: å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã€å…±é€šå‡¦ç†ã€ã‚ˆã‚Šè‰¯ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒå¯èƒ½ã«
- **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: å…¨ã¦ã®GoRouteDataã‚¯ãƒ©ã‚¹ã«`with _$ClassName`ã‚’è¿½åŠ 

ã“ã®å¤‰æ›´ã§å‹å®‰å…¨æ€§ãŒå‘ä¸Šã—ã€ã‚ˆã‚Šç¢ºå®Ÿã§ä¿å®ˆã—ã‚„ã™ã„ã‚³ãƒ¼ãƒ‰ç”ŸæˆãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
æ—©ã‚ã«ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦ãŠãã®ãŒãŠã™ã™ã‚ã§ã™ğŸ‘

### å‚è€ƒãƒªãƒ³ã‚¯

- [Issue #106790 - ä»Šå›ã®å¤‰æ›´ã®èƒŒæ™¯](https://github.com/flutter/flutter/issues/106790)
- [PR #9275 - mixinå®Ÿè£…](https://github.com/flutter/packages/pull/9275)
- [go_router_builder 3.0.0 Changelog](https://pub.dev/packages/go_router_builder/changelog)
- [go_routerå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://pub.dev/packages/go_router)
- [Flutterå…¬å¼: Type-safe routing](https://docs.flutter.dev/ui/navigation/go-router)
