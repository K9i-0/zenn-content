---
title: "タコでもわかるDartマクロ作成入門"
emoji: "🐙"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ['flutter', 'dart', 'macros']
publication_name: yumemi_inc
published: false
---
## はじめに
:::message
Dart 3.4発表直後の記事なので、数ヶ月後には古い情報になっていると思います。
:::

Google I/O 2024でFlutter発表の目玉の一つとして、Dartのマクロ(macros)機能が発表されました。
これまでコード生成に頼っていたJsonのシリアライズ・デシリアライズ、データクラス作成がより効率的に行えるということで注目されています。

より詳しい情報はDart 3.4のMedium記事をどうぞ
https://medium.com/dartlang/dart-3-4-bd8d23b4462a


## マクロを自分でも作ってみたい

マクロはDartのdev版、Flutterのmaster版ですでに利用可能です。
海外のつよつよエンジニアがいくつかマクロを公開しています。

Dart公式のJsonCodableマクロ
https://pub.dev/packages/json

Remiさんのマクロ版Freezed
https://pub.dev/packages/freezed/versions/3.0.0-0.0.dev

Felangelさんのデータクラスマクロ
https://pub.dev/packages/data_class_macro

これらマクロを試す分にはいいのですが、個人的にはもっと簡単なサンプルがみたいなーと思いました。(作ってる人たちがすごすぎて実装が高度🥹)

## 簡単なマクロを作ってみた

そういう訳で非常にシンプルなHello World!とプリントするだけのメソッドを生やすマクロを作ってみました。

https://github.com/K9i-0/k9i_macro_sample

```dart
@Hello()
class Sample {}
```

とするとこういうコードが作られて

```dart
augment class Sample {
  void hello() => print("Hello, World!");
}
```

mainメソッドで利用できます。
```dart:main.dart
@Hello()
class Sample {}

void main() {
  final sample = Sample();
  sample.hello();
}
```

実行時はこのようにすれば、Hello World!と表示されます。
```zsh
$ dart --enable-experiment=macros run main.dart 
$ Hello, World!
```

## 作り方

それではこのマクロの作り方です。

### dev版のDartを入れる
記事執筆時点ではマクロを使うのにdev版のDartが必要です。

今回は同僚の[おかやまんさん](https://zenn.dev/blendthink)