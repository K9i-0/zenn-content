---
title: "【Flutter】Dart3リリースにあわせて読みたいpubspecの要求sdkバージョンの話"
emoji: "🐙"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["flutter", "dart"]
published: false
---
## はじめに
Flutter開発時にパッケージの依存などを記述するpubspec.yamlについて、面白いこと発見したので共有記事です。

## dart sdkの要求バージョン
pubspec.yamlのenviromentにはdartやflutter sdkの要求バージョンを記述します。
以下の場合はdart sdkが2.17.0以上3.0.0未満であることを要求します。
```yaml:pubspec.yaml
environment:
  sdk: ">=2.17.0 <3.0.0"
```

sdkバージョンの制約はFlutterアプリのプロジェクトだけでなく、依存するパッケージにも設定されています。
例えば以下のように指定されているパッケージに依存している場合
```yaml:pubspec.yaml
environment:
  sdk: '>=2.19.0 <3.0.0'
```
pubspec.lockが以下のようになります。
```pubspec.lock
sdks:
  dart: ">=2.19.0 <3.0.0"
```
この状態で例えばdart 2.18.6を使っているflutter 3.3.10を使うとpub getでエラーになります。
```
[flutter_mcu_sample] flutter pub get
Running "flutter pub get" in flutter_mcu_sample...              
The current Dart SDK version is 2.18.6.

Because flutter_mcu_sample depends on custom_lint >=0.2.11 which requires SDK version >=2.19.0 <3.0.0, version solving failed.
pub get failed (1; Because flutter_mcu_sample depends on custom_lint >=0.2.11 which requires SDK version >=2.19.0 <3.0.0, version solving failed.)
exit code 1
```

## dart 3で発生する問題


## 余談

### 自作パッケージを作成する場合どのバージョンを指定するのが無難か
flutterfireは公式に従っているそうなので、それを基準にするのが良さそうです。
https://github.com/firebase/flutterfire/pull/10946

記事執筆時点では以下です。
```yaml:pubspec.yaml
environment:
  sdk: '>=2.18.0 <4.0.0'
  flutter: '>=3.3.0'
```
もちろんFlutterに依存しないパッケージならflutterの行は不要です。

また、より新しいsdkのAPIを使う場合はそのバージョンを指定しましょう。その際、パッケージの要求sdkバージョンは適度に広いほうが良いです。
例えばflutter 3.3.0までのAPIしか使ってないのに、flutter: '>=3.10.0'としてしまうと最新のFlutterにアプデできてない人を切り捨てることになってしまいます。
